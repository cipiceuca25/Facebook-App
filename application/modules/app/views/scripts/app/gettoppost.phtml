<?php $count = 0?>
<?php foreach($this->top_post as $topPost): ?>
											
		
		<li class="post-container" >
	
			<div class="user">
				<div class="user-badge">
					<a rel="tooltip-follow" class ="follow_<?=$topPost['facebook_user_id']?>"<?php switch($this->relation[$count]) { 
						case 'You':?>
							 data-original-title="This is You"><span class="badge badge-You">You</span>
						<?break;?>
						<?case 'Following'?>
							onclick="unfollow(<?=$topPost['facebook_user_id']?> ,'<?=$topPost['fan_first_name'].' '.$topPost['fan_last_name']?>')" 
							data-original-title="Click to Unfollow this User"><span class="badge badge-Following">Following</span>
						<?break;?>
							
						<?default:?>
							onclick="follow(<?=$topPost['facebook_user_id']?> , '<?=$topPost['fan_first_name'].' '.$topPost['fan_last_name']?>')" 
							data-original-title="Click to Follow this User"><span class="badge badge-<?= $this->relation[$count]?>"><?= $this->relation[$count]?></span>
						<?}?>
					</a>		
				</div> 
				<div class="photo"><a data-toggle="modal"
					<? if (($this->relation[$count] != 'Fanpage')){?> 
						onclick="userProfile('<?=$topPost['facebook_user_id']?>')"
						rel="popover" 
						data-content="" 
						data-original-title="" 
						data-placement="toppost" 
						data-userid="<?=$topPost['facebook_user_id']?>"
					<?php }?>><img class="face" width="30" height="30" src="https://graph.facebook.com/<?= $topPost['facebook_user_id']?>/picture" onerror="ImgError(this);">
					</a></div>
					<div class="name"><a data-toggle="modal"
					<? if (($this->relation[$count] != 'Fanpage')){?> 
						onclick="userProfile('<?=$topPost['facebook_user_id']?>')"
						rel="popover" 
						data-content="" 
						data-original-title="" 
						data-placement="toppost" 
						data-userid="<?=$topPost['facebook_user_id']?>"
					<?php }?>><?= $topPost['fan_first_name'] ?> <?= $topPost['fan_last_name'] ?></a></div>
			</div>
			
			
			
			<div class="post">
				
				<div class="message">
			
				<?php 
							$reg_ex = "/\n/";
							$message = $this->escape($topPost['post_message']);
							if(preg_match_all($reg_ex, $message, $url)) {
								$message= preg_replace($reg_ex, "<br/>", $message);
							} 
							
							$reg_exUrl = "/(http|https|ftp|ftps)\:\/\/[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,5}(\/\S*)?/";
						
							$m = preg_match_all($reg_exUrl, $message, $match); 
							
							if ($m) { 
							    $links=$match[0]; 
							    for ($j=0;$j<$m;$j++) { 
							        $message=str_replace($links[$j],'<a href="'.$links[$j].'" target="new">'.$links[$j].'</a>',$message); 
							    } 
							} 
							
							echo trim($message); 
								//echo preg_replace($reg_exUrl, "<a href=".$url[0][0]." target=_new>".$url[0][0]."</a> ", $m);
							
							?><br/>
				</div>							
				<div class="graphical">	
						<?php if (($topPost['post_type'] == 'photo') || ($topPost['post_type']  =='video')) {?>	
							
								<a target="new" href="<?echo $this->escape($topPost['link'])?> "> 
										<img src = '<?echo (str_replace('_s.jpg', '_n.jpg', $topPost['picture']))?> '/>
								</a>
							
						<?}elseif ($topPost['post_type']  == 'link') {?>
						
							<div class="link">
								<?php if ($topPost['picture'] != null) {?>
								<div class="link-left">
									<a target="new" href="<?echo $this->escape($topPost['link'])?> "> 
										<img src = '<?echo (str_replace('_s.jpg', '_n.jpg', $topPost['picture']))?> '/>
									</a>
								</div>
								<?php }?>
								<div class="link-right">
									<a target="new" class="link-title" href="<?echo $this->escape($topPost['link'])?>">
										<?= (isset($topPost['name'])?$this->escape($topPost['name']): $this->escape($topPost['link']))?>
									</a>
									<?php if(isset($post->caption)){?>
										<br/>
										<a target="new" class="link-caption" href="<?echo $this->escape($topPost['link'])?> ">
											<?php echo $this->escape($topPost['caption']);?>:  
										</a>
									<?php }?>	
								
									<?php if (isset($topPost['description'])){?>
											<?=$this->escape($topPost['description'])?> 
										
									<?php }?>
								</div>
							</div>
						<?}?>
				</div>
			
				
			</div>
				
				
		 <div class="social"> 
			
				<a class="like_control_<?= $topPost['post_id']?>" rel="tooltip" data-placement="top"
				<?php if ($this->likes[$count] == 0) {?>
					data-original-title="Click to like this" onclick="like('<?= $topPost['post_id']?>', '<?= $topPost['post_type']?>', '<?=$topPost['facebook_user_id']?>','<?= $topPost['fan_first_name'].' '.$topPost['fan_last_name'] ?>' )" >Like  
				<?}else{?>
					data-original-title="You like this" onclick="unlike('<?= $topPost['post_id']?>', '<?= $topPost['post_type']?>', '<?=$topPost['facebook_user_id']?>','<?= $topPost['fan_first_name'].' '.$topPost['fan_last_name'] ?>')">Unlike  
				<?php }?></a>
		
				 &middot;
		
				 <a onclick="popup_post('<?= $topPost['post_id']?>', 10, true)">Comment</a>
		
				&middot;
				
				<a rel="tooltip" data-placement="top" class="time" data-original-title="" data-unix-time="<?= strtotime($topPost['created_time'])?>"></a>
			<br/>
		</div>
			
	<div class="social like <?=$topPost['post_id']?>"  <?php if(!isset($topPost['post_likes_count']) || ($topPost['post_likes_count'] == 0)){?>style="display:none"<?php }?>>
		
		
			<a rel="tooltip" data-placement="top" onclick="getLikesList('<?=$topPost['post_id']?>', true)" data-original-title="
						<?php 	$likeslist = $this->likeslist[$count];
								$countlikes = count($likeslist);
								for($i = 0; $i < $countlikes - 1; $i++){
									echo $likeslist[$i]->name.', ';
								}

								echo $likeslist[$i]->name;
								if ($countlikes < $topPost['post_likes_count']){
									echo " and ".($topPost['post_likes_count'] - $countlikes)." others";
								}
						?> likes this.
			">
				<img src = "/img/thumbsup.png" />
				<span class="like_<?= $topPost['post_id']?>"><? if(isset($topPost['post_likes_count'])){echo $topPost['post_likes_count'];}else{echo '0';} ?>
					
					<?php if($topPost['post_likes_count'] == 1){?>person<?php }else{?>people<?php }?> 
				
				</span>
				likes this
			</a>		
		
	
	</div>

	
	<div class="social comment <?=$topPost['post_id']?>" <?php if(!isset($topPost['post_comments_count']) || ($topPost['post_comments_count'] == 0)){?> style="display:none" <?}?>>
	
			 <a   onclick=" popup_post('<?= $topPost['post_id']?>', 10, true)">
			 	<img src="/img/comment.png" />
			 	<?php if($topPost['post_comments_count'] != 1){?> 
			 		View all <span class="comment_<?= $topPost['post_id']?>"> 
			 		<?php if(isset($topPost['post_comments_count'])){
						echo $topPost['post_comments_count']; //echo  $post->comments->count;
					 	} else {
							echo '0'; 
						}?>
					</span> 
					comments 
				<?php }else { ?>
					View all<span class="comment_<?= $topPost['post_id']?>"></span>
					comments 
				<?php }?>
			</a>
	</div>
		
											
										
	</li>

<?php $count ++;?>
<?php endforeach; ?>

<?php if (!($this->top_post)) {?>
		<li class="post-container" >
			<div class="user">
			</div>
			<div class="post">
				<div class="message">
						There are no Top Posts this week
				</div>							
			</div>
		</li>				
<?php }?>
		