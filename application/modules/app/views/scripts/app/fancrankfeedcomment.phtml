
<?php $count = 0?>

<?php if(!empty($this->comments)){?>

<?php foreach ($this->comments as $post): ?>		

		
	<li class="comment-container" >

		<div class="photo"><a  
			<? if (!($this->relation[$count] == 'Fanpage')){?> 
				onclick="userProfile('<?=$post->from->id?>')"
				rel="popover" 
				data-content="" 
				data-original-title="" 
				data-placement="right" 
				data-userid="<?=$post->from->id?>"
			<?php }?> 
		><img class="face" width="30" height="30" src="https://graph.facebook.com/<?= $post->from->id ?>/picture" onerror="ImgError(this);"></a></div>
		
	
	
	<div class="user">
		
		<div class="user-badge">
			<a rel="tooltip-follow" class ="follow_<?=$post->from->id?>" <?php switch($this->relation[$count]) { 
				case 'Fanpage':?>
					 data-original-title="You can't Follow an Admin"><span class="badge badge-Fanpage">Admin</span>
				<?break;?>
				<?case 'You':?>
					 data-original-title="This is You"><span class="badge badge-You">You</span>
				<?break;?>
				<?case 'Following':?>
					onclick="unfollow(<?=$post->from->id?> ,'<?=$post->from->name?>')" 
					data-original-title="Click to Unfollow this User"><span class="badge badge-Following">Following</span>
				<?break;?>
					
				<?default:?>
					onclick="follow(<?=$post->from->id?> , '<?=$post->from->name?>')" 				
					data-original-title="Click to Follow this User"><span class="badge badge-<?= $this->relation[$count]?>"><?= $this->relation[$count]?></span>
				<?}?>
			</a>
		</div>	
	
		
		
		<div class="name"><a  
			<? if (!($this->relation[$count] == 'Fanpage')){?> 
				onclick="userProfile('<?=$post->from->id?>')"
				rel="popover" 
				data-content="" 
				data-original-title="" 
				data-placement="right" 
				data-userid="<?=$post->from->id?>"
			<?php }?> 
		><?=  $post->from->name?></a></div>
		
		
	
		
		

	<span class="message">
	
	<?php if(isset($post->message)){  
							$reg_ex = "/\n/";
							$message = $this->escape($post->message);
							if(preg_match_all($reg_ex, $message, $url)) {
								$message= preg_replace($reg_ex, "<br/>", $message);
							} 
							
							$reg_exUrl = "/(http|https|ftp|ftps)\:\/\/[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,5}(\/\S*)?/";
						
							$m = preg_match_all($reg_exUrl, $message, $match); 
							
							if ($m) { 
							    $links=$match[0]; 
							    for ($j=0;$j<$m;$j++) { 
							        $message=str_replace($links[$j],'<a href="'.$links[$j].'" target="_new">'.$links[$j].'</a>',$message); 
							    } 
							} 
							
							echo $message; 
								//echo preg_replace($reg_exUrl, "<a href=".$url[0][0]." target=_new>".$url[0][0]."</a> ", $m);
							
						
				}?>
	
	</span>
	</div>
	<div class="social"> 
	 	
		<a rel="tooltip" data-placement="top" class="time" data-original-title="" data-unix-time="<?=  strtotime($post->created_time)?>"></a>
		
		&middot;
		
		<!--  <img src="/img/news-feed/icon-likes.png" /> -->
		<span class="likes">
		<span class="like_<?= $post->id?>"><? if(isset($post->likes)){echo $post->likes;}else{echo '0';} ?> </span>
		
		<a class="like_control_<?= $post->id?>" rel="tooltip" data-placement="top"
		<?php if ($this->likes[$count] == 0) {?>
			 data-original-title="Click to like this" onclick="like('<?= $post->id?>', 'comment', '<?=$post->from->id?>','<?=$post->from->name?>')">Like 
		<?}else{?>
			 data-original-title="You like this" onclick="unlike('<?= $post->id?>', 'comment', '<?=$post->from->id?>','<?=$post->from->name?>')">Unlike
		<?php }?></a>
		 </span>	 

	 </div>

	</li>
										
<?php $count ++;?>
<?php endforeach; }?>

	
	<?if ($this->total > $this->limit){ ?>
		<button class="btn-more" onclick="comment_feed<?= ($this->latest == 'true')?'2':''?>('<?= $this->postId ?>','<?= $this->postType?>', <?=$this->limit + 5?> , <?= $this->total?> , false)">MORE COMMENTS +</button>
	<?}?>
	<li class="comment-container">
		<div class="photo"><img class="face" width="30" height="30" src="https://graph.facebook.com/<?= $this->userid?>/picture" onerror="ImgError(this);"></div>
	
		<form action="#" class="submit-form" >
		
			<textarea class="comment-box" id="comment_box_<?= $this->postId ?>" onkeyup="resizeCommentBox(this)" ></textarea>
			<input type=button class="btn-submit" value="Comment" onclick="commentSubmit('<?= $this->postId ?>','<?=$this->postType?>' ,'<?=$this->postOwner['user_id']?>','<?=$this->postOwner['user_name']?>',<?= ($this->latest == 'true')?'true':'false'?> )">
		</form>
		
				
	</li>
			
			