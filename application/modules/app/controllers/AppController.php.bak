<?php

class App_AppController extends Fancrank_App_Controller_BaseController
{
    public function indexAction()
    {
        echo 'hi';
        exit();
    }

  	public function topfansAction()
  	{
  		$this->view->fanpage_id = $this->data['page']['id'];
  		$this->view->fan_id = $this->data['user_id'];

  		$model = new Model_Rankings;

  		$this->view->top_fans = $model->getRanking($this->data['page']['id'], 'FAN', false, 5);
  		$this->view->most_popular = $model->getRanking($this->data['page']['id'], 'POPULAR', false, 5);
  		$this->view->top_talker = $model->getRanking($this->data['page']['id'], 'TALKER', false, 5);
  		$this->view->top_clicker = $model->getRanking($this->data['page']['id'], 'CLICKER', false, 5);

  		/*
  		 $client = new Zend_Http_Client;
  		$client->setUri('https://graph.facebook.com/' . $this->view->fan_id;
  				$client->setMethod(Zend_Http_Client::GET);

  				try {
  				$response = $client->request();
  				} catch (Exception $e) {

  				}

  				$json = Zend_Json::decode($response->getBody(), Zend_Json::TYPE_OBJECT);

  				if (property_exists($json, 'error')) {
  				// try again

  				} else {
  				$this->view->me = $json->data;
  				}
  				*/

  		$this->view->user_top_fans = $model->getUserRanking($this->data['page']['id'], 'FAN', $this->view->fan_id);
  		$this->view->user_most_popular = $model->getUserRanking($this->data['page']['id'], 'POPULAR', $this->view->fan_id);
  		$this->view->user_top_talker = $model->getUserRanking($this->data['page']['id'], 'TALKER', $this->view->fan_id);
  		$this->view->user_top_clicker = $model->getUserRanking($this->data['page']['id'], 'CLICKER', $this->view->fan_id);
  		
  		$this->render('topfans');

  	}

    public function logoutAction()
    {
        $this->_identity = $this->_auth->clearIdentity();
        $this->_helper->redirector('index', 'index', 'app', array($this->_getParam('id') => ''));   
    }
    
    public function newsfeedAction() 
    {
    	$this->render('newsfeed');
    }
}

